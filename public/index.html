<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=" crossorigin="anonymous"></script>
<script>
var startoff = new Date('2016 April 18 0:00:00').getTime();
var off;
var timeouts = { watching: false, watched: false };

$(document).ready(function() {

  var person = window.location.search.substring(3);
  $(document).prop('title', person);

  setInterval(updateClips, 1000);

  function updateClips() {
    off = new Date().getTime() - startoff;
    $.getJSON('/get_clips?off='+off, function(data) {
      console.log(off)
      data.forEach(function(clip) {       
        if (person === clip.person) {
          var elt = $('#'+clip.type);
          if (elt.attr('src') !== clip.path) {
            var skip = off - clip.startoff;
            var rest = clip.duration - skip;
            if (timeouts[clip.type]) clearTimeout(timeouts[clip.type]);
            timeouts[clip.type] = setTimeout(function() {
              elt.css('opacity', 0);
            }, rest);

            elt.css('opacity', 1);
            elt.attr('src', clip.path);
            elt.currentTime = Math.floor(skip / 1000);
          }
        }
      });
    });
  }
});

</script>
<style>
body {
  margin: 0;
  padding: 0;
  background: black;
}
video {
  width: 50%;
  float: left;
}
</style>
</head>

<body>
<video id='watching' autoplay></video>
<video id='watched' autoplay></video>
</body>
</html>